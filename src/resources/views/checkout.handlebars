<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/kdoan.css">
    <link rel="stylesheet" href="/css/homepage.css">
    <script src="https://kit.fontawesome.com/38843893d5.js" crossorigin="anonymous"></script>
</head>

<body>
    {{> homepage_header}}

    <main>
        <div class="container">
            <div class="row mb-3 text-center">
                <h2 class="float-start p-4">Review Your Order</h2>
                <div class="col-md-8 themed-grid-col">

                    {{!-- {{#if products}}
                    {{#each products}}
                        {{#each products.owner}}
                        <div class="card container mb-2">
                        <div class="container mb-3">
                            <div class="order-shop py-3">
                                {{product.product_name}}</div>
                            <div class="order-content">
                                <div class="checkout order-details">
                                    <div class="order-columns">
                                        <div class="order-info-product px-3">
                                            <div class="float-start">
                                                <p class="float-start"><strong>
                                                        Iphone 13</strong></p><br>
                                                <p class="float-start">Quantity: 2</p><br>
                                                <button type="button"
                                                    class="remove btn btn-primary float-start ">Remove</button>
                                            </div>
                                            </p>
                                        </div>
                                        <div class="order-product-img">
                                            <div>
                                                <img src="/image/example-order.jpeg" alt="">
                                            </div>
                                        </div>
                                        <div class="order-product-price">
                                            <p>$50</p>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            <hr>
                            <div class="order-total pb-3">
                                Total: $100
                            </div>
                        </div>

                    </div>
                        {{/each}}
                    {{/each}}
                    {{else}}
                    {{/if}} --}}



                    <div class="card container mb-2">
                        <div class="container mb-3">
                            <div class="order-shop py-3">
                                Cellphone S</div>
                            <div class="order-content">
                                <div class="checkout order-details">
                                    <div class="order-columns">
                                        <div class="order-info-product px-3">
                                            <div class="float-start">
                                                <p class="float-start"><strong>
                                                        Iphone 13</strong></p><br>
                                                <p class="float-start">Quantity: 2</p><br>
                                                <button type="button"
                                                    class="remove btn btn-primary float-start ">Remove</button>
                                            </div>
                                            </p>
                                        </div>
                                        <div class="order-product-img">
                                            <div>
                                                <img src="/image/example-order.jpeg" alt="">
                                            </div>
                                        </div>
                                        <div class="order-product-price">
                                            <p>$50</p>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            <hr>
                            <div class="order-total pb-3">
                                Total: $100
                            </div>
                        </div>

                    </div>

                    <div class="card container mb-2">
                        <div class="container mb-3">
                            <div class="order-shop py-3">Radiant Beauty</div>
                            <div class="order-content">
                                <div class="checkout order-details">
                                    <div class="order-columns">
                                        <div class="order-info-product px-3">
                                            <div class="float-start">
                                                <p class="float-start"><strong>Ofelia Lipstick</strong></p><br>
                                                <p class="float-start">Quantity: 1</p><br>
                                                <button type="button"
                                                    class="remove btn btn-primary float-start ">Remove</button>
                                            </div>
                                            </p>
                                        </div>
                                        <div class="order-product-img">
                                            <div>
                                                <img src="/image/example-order.jpeg" alt="">
                                            </div>
                                        </div>
                                        <div class="order-product-price">
                                            <p>$30</p>
                                        </div>
                                    </div>

                                    <!--If customer buy 2 different items of one shop-->
                                    <hr>

                                    <div class="order-columns">
                                        <div class="order-info-product px-3">
                                            <div class="float-start">
                                                <p class="float-start"><strong>Rare Beauty Blush</strong></p><br>
                                                <p class="float-start">Quantity: 1</p><br>
                                                <button type="button"
                                                    class="remove btn btn-primary float-start ">Remove</button>
                                            </div>
                                            </p>
                                        </div>
                                        <div class="order-product-img">
                                            <div>
                                                <img src="/image/example-order.jpeg" alt="">
                                            </div>
                                        </div>
                                        <div class="order-product-price">
                                            <p>$40</p>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            <hr>
                            <div class="order-total pb-3">
                                Total: $70
                            </div>
                        </div>

                    </div>

                </div>
                <div class=" col-md-4 themed-grid-col">
                    <div class="card container px-4 mb-2">
                        <br>
                        <div class="alert alert-warning not-display" id="warning_user">Please choose your distribution
                            hub!</div>
                        <div class="row">
                            <div class=" col">
                                <h3 class="py-3 float-start">Order Summary</h3>
                            </div>
                        </div>
                        <div class="row">
                            <div class=" col">
                                <p class="float-start">Items:</p>
                            </div>
                            <div class="col">
                                <p class="float-end">4</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class=" col">
                                <p class="float-start">Subtotal:</p>
                            </div>
                            <div class="col">
                                <p class="float-end">$170</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class=" col">
                                <p class="float-start">Shipping fee:</p>
                            </div>
                            <div class="col">
                                <p class="float-end">$5</p>
                            </div>
                        </div>
                        <div class="form-floating">
                            <select class="form-select" id="distributionSelect" aria-label="Distribution Select">
                                <option selected>Choose your distribution hub</option>
                                <option value="HCM">Ho Chi Minh</option>
                                <option value="HN">Ha Noi</option>
                                <option value="DN">Da Nang</option>
                            </select>
                            <label for="distributionSelect">Distribution Hub</label>
                        </div>
                        <hr>
                        <div class="total row">
                            <div class=" col">
                                <p class="float-start">Order Total:</p>
                            </div>
                            <div class="col">
                                <p class="float-end">$175</p>
                            </div>
                        </div>
                        <div class="row">
                            <!-- Button trigger modal -->
                            <button type="button" class="mb-4 btn btn-warning" data-bs-toggle="modal"
                                data-bs-target="#ordersuccessModal" id="place_order">Place Your Order</button>
                            <!-- Modal -->
                            <div class="order-success-button modal fade" id="ordersuccessModal" tabindex="-1"
                                aria-labelledby="ordersuccessModalLabel" aria-hidden="true">
                                <div class="order-success-button modal-dialog modal-dialog-centered">
                                    <div class="order-success-button modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="ordersuccessModalLabel">Your Order Has Been
                                                Received</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body text-center ">
                                            <span><i class="fa-regular fa-heart fa-2xl"></i></span><br><br>
                                            <p class="lh-lg">Thank you for your purchase! <br>
                                                Now we're preparing for the shipment. If you have any questions or
                                                feedback, please don't
                                                hestitate to reach out. <br>
                                                <strong><em>Have a great day!</em></strong>
                                            </p>
                                        </div>
                                        <div class="order-success-button modal-footer d-flex justify-content-center">
                                            <a class="btn btn-secondary" data-bs-dismiss="modal" href="#"
                                                role="button">Continue Shopping</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>


                </div>
            </div>

    </main>
    {{> footer}}



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>

    <script>

        let place_order_btn = document.querySelector("#place_order")
        let check_distribution = document.querySelector("#distributionSelect");
        let warning = document.querySelector("#warning_user");
        setInterval(check_condition, 250);
        function check_condition() {

            if (check_distribution.value !== "Choose your distribution hub") {
                place_order_btn.removeAttribute("disabled");
                warning.removeAttribute('display');
                warning.setAttribute('class', "alert alert-warning not-display");
            }
            else {
                place_order_btn.setAttribute('disabled', 'disabled');
                warning.removeAttribute('not-display');
                warning.setAttribute('class', " alert alert-warning display");
            }
        }

    </script>
    <script>
        // Render products in cart
        
// document.addEventListener('DOMContentLoaded', () => {//lấy từ trong database cart

//     const orderedProducts = JSON.parse('{{productsJson}}');

//     if (orderedProducts.length > 0) {
//         renderCart(orderedProducts);
//     } else {
//         displayEmptyCart();
//     }
//     });

//     function renderCart(orderedProducts) {
//         let owners = {};
//         const container = document.querySelector('.col-md-8.themed-grid-col');

//         orderedProducts.forEach(product => {
//             if (!owners[product.owner]) {
//                 owners[product.owner] = [];
//             }
//             owners[product.owner].push(product);
//         });

//         for (const owner in owners) {
//             const card = createCard(owners[owner], owner);
//             container.appendChild(card);
//         }
//     }

//     function createCard(products, owner) {
//         const card = document.createElement('div');
//         card.className = 'card container mb-2';

//         const cardContent = document.createElement('div');
//         cardContent.className = 'container mb-3';

//         const ownerTitle = document.createElement('div');
//         ownerTitle.className = 'order-shop py-3';
//         ownerTitle.textContent = owner;

//         const divider = document.createElement('hr');

//         const orderTotal = document.createElement('div');
//         orderTotal.className = 'order-total pb-3';
//         const totalPrice = products.reduce((sum, product) => sum + product.price * product.quantity, 0);

//         // Changing order summary
//         orderTotal.textContent = `Total: $${totalPrice}`;
//         const subTotal = document.querySelector('#sub_total');
//         subTotal.textContent = `$${totalPrice}`;
//         const shippingFeeElem = document.querySelector('#shipping-fee');
//         const itemsElem = document.querySelector('#order-items');
//         const finalTotal = document.querySelector('#final_total');

//         itemsElem.textContent = products.length;
//         const shippingFee = 5
//         shippingFeeElem.textContent = `$${shippingFee}`;
//         finalTotal.textContent = `$${totalPrice + shippingFee}`;

//         cardContent.appendChild(ownerTitle);

//         products.forEach(product => {
//             const productRow = createProductRow(product);
//             cardContent.appendChild(productRow);
//         });

//         cardContent.appendChild(divider);
//         cardContent.appendChild(orderTotal);
//         card.appendChild(cardContent);

//         return card;
//     }

//     function createProductRow(product) {
//         const order_content = document.createElement('div');
//         order_content.className = 'order-content'

//         const orderInfo = document.createElement('div');
//         orderInfo.className = 'checkout order-details';

//         const columns = document.createElement('div');
//         columns.className = 'order-columns';

//         const info = document.createElement('div');
//         info.className = 'order-info-product px-3';

//         const float_start = document.createElement("div");
//         float_start.className = 'float-start'

//         const name = document.createElement('p');
//         name.className = 'float-start'
//         name.innerHTML = `<strong>${product.product_name}</strong>`;
//         const br = document.createElement("br");
//         const br1 = document.createElement("br");
//         const hr = document.createElement("hr");


//         const quantity = document.createElement('p');
//         quantity.className = 'float-start'
//         quantity.innerHTML = `Quantity: ${product.quantity}`;

//         const p = document.createElement("p");

//         const remove = document.createElement('button');
//         remove.textContent = 'Remove';
//         remove.setAttribute('type', 'button')
//         remove.className = 'remove btn btn-primary float-start';
//         remove.addEventListener('click', () => {
//             removeProductFromCart(product._id);
//         });
//         float_start.appendChild(name);
//         float_start.appendChild(br)
//         float_start.appendChild(quantity);
//         float_start.appendChild(br1)
//         float_start.appendChild(remove);
//         info.appendChild(float_start);
//         info.appendChild(p)

//         // Image for carted products
//         const imgContainer = document.createElement('div');
//         imgContainer.className = 'order-product-img';
//         const div_img = document.createElement('div')
//         const img = document.createElement('img');
//         img.src = `data:image/png;base64,${product.img}`;
//         console.log(img)
//         img.alt = product.product_name;
//         div_img.appendChild(img);
//         imgContainer.appendChild(div_img)

//         const price = document.createElement('div');
//         price.className = 'order-product-price';
//         price.innerHTML = `<p>$${product.price * product.quantity}</p>`;

//         columns.appendChild(info);
//         columns.appendChild(imgContainer);
//         columns.appendChild(price);

//         orderInfo.appendChild(columns);
//         order_content.appendChild(orderInfo)
//         order_content.appendChild(hr)


//         return order_content;
//     }

//     function removeProductFromCart(productId) {
//         let orderedProducts = JSON.parse(localStorage.getItem('orderedProducts')) || [];
//         orderedProducts = orderedProducts.filter(product => product._id !== productId);
//         localStorage.setItem('orderedProducts', JSON.stringify(orderedProducts));
//         location.reload();
//     }

//     function displayEmptyCart() {
//         const container = document.querySelector('.col-md-8.themed-grid-col');
//         const message = document.createElement('p');
//         message.textContent = 'There are no items in your cart.';
//         container.appendChild(message);
//     }


    </script>
    <script>
        const ordersuccessModalElem = document.getElementById('ordersuccessModal');

        // Remove any existing event listeners
        ordersuccessModalElem.replaceWith(ordersuccessModalElem.cloneNode(true));
        const newOrdersuccessModalElem = document.getElementById('ordersuccessModal');

        // Attach a new event listener
        newOrdersuccessModalElem.addEventListener('shown.bs.modal', () => {
            placeOrder();
        });

        // Place Order
        async function placeOrder() {
            console.log("placeOrder() called");
            const form = document.querySelector("form");
            const distributionSelect = document.getElementById("distributionSelect");
            const distributionHubValue = distributionSelect.value;

            console.log(distributionHubValue);

            try {
                const requestBody = {
                    distributionHub: distributionHubValue,
                };
                const response = await fetch("/home/product-detail/checkout", {
                    method: "POST",
                    body: JSON.stringify(requestBody),
                    headers: {
                        "Content-Type": "application/json",
                    },
                });

                if (response.status === 200) {
                    console.log("Order submitted successfully!");
                } else {
                    console.log("Oops! Something went wrong. Please try again.");
                }
            } catch (error) {
                console.log("Error occurred while submitting the order. Please try again.");
            }
        }
    </script>
</body>

</html>